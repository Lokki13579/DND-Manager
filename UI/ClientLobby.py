# Form implementation generated from reading ui file 'RawUI/ClientLobby.ui'
#
# Created by: PyQt6 UI code generator 6.9.1
#
# WARNING: Any manual changes made to this file will be lost when pyuic6 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt6 import QtCore, QtWidgets
from PyQt6.QtWidgets import QVBoxLayout, QWidget, QStackedWidget
from OtherPyFiles.server_client import dataSize
from UI.playerCard.PlayerCard import Ui_PlayerCard
from UI.CharactersList import Ui_CharsList
from OtherPyFiles.characterclass import Character


class Ui_Lobby(QWidget):
    def __init__(self, client):
        super().__init__()
        self.ClientOBJ = client
        self.character = Character()
        self.setupUi()

    def setupUi(self):
        self.vbox = QVBoxLayout(self)
        self.stackedWidget = QStackedWidget(self)
        self.vbox.addWidget(self.stackedWidget)

        self.CharSelect = Ui_CharsList(self.ClientOBJ)

        self.CharSelect.CharactersList.doubleClicked.connect(self.showCard)
        self.stackedWidget.addWidget(self.CharSelect)
        self.Card = Ui_PlayerCard(char=self.character)
        for client in self.ClientOBJ:
            client.data_updated.connect(self.data_updated)
        self.Card.needToSend.connect(self.send)
        self.stackedWidget.addWidget(self.Card)
        self.stackedWidget.setCurrentWidget(self.CharSelect)

    def data_updated(self, type, data):
        match type:
            case "character":
                self.character = data
            case "stats":
                self.character.setStats(eval(data))
            case "spellCells":
                self.character.spellCells = eval(data)
            case "status":
                self.character.status = eval(data)
        self.Card.updateData(self.character)

    def send(self, dataToSend):
        if dataToSend:
            match dataToSend.split("&"):
                case ["newLevel", l]:
                    if l != -1:
                        self.ClientOBJ[0].send_message(dataToSend)
                        self.Card.updateData(self.character)
                        return
                case ["newExp", exp]:
                    self.ClientOBJ[0].send_message(dataToSend)
                    self.Card.updateData(self.character)
                    return
                case ["newSpellCells", cells]:
                    self.ClientOBJ[1].send_message(dataToSend)
                    self.Card.updateData(self.character)
                    return
                case ["newStatus", status]:
                    self.ClientOBJ[2].send_message(dataToSend)
                    self.Card.updateData(self.character)
                    return
                case _:
                    pass

        self.ClientOBJ[0].send_message("newStats&" + str(self.character.stats))
        self.ClientOBJ[1].send_message("newSpells&" + str(self.character.spellCells))
        self.ClientOBJ[2].send_message("newStatus&" + str(self.character.status))
        self.Card.updateData(self.character)

    def showCard(self):
        self.character = self.CharSelect.currCharacter
        self.stackedWidget.setCurrentIndex(1)
        self.ClientOBJ[0].send_message("char_name&" + self.character.name)
        self.send(None)
